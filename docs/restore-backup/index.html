<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-restore-backup" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">How to restore a Backup on a different server or upgrade Ubuntu? | Nextcloud-NAS-Guide</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://szaimen.github.io/Nextcloud-NAS-Guide/docs/restore-backup"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="How to restore a Backup on a different server or upgrade Ubuntu? | Nextcloud-NAS-Guide"><meta data-rh="true" name="description" content="Theoretically it could happen that your system drive fails or that you need to update the Ubuntu version."><meta data-rh="true" property="og:description" content="Theoretically it could happen that your system drive fails or that you need to update the Ubuntu version."><link data-rh="true" rel="icon" href="/Nextcloud-NAS-Guide/img/favicon.webp"><link data-rh="true" rel="canonical" href="https://szaimen.github.io/Nextcloud-NAS-Guide/docs/restore-backup"><link data-rh="true" rel="alternate" href="https://szaimen.github.io/Nextcloud-NAS-Guide/docs/restore-backup" hreflang="en"><link data-rh="true" rel="alternate" href="https://szaimen.github.io/Nextcloud-NAS-Guide/docs/restore-backup" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/Nextcloud-NAS-Guide/news/rss.xml" title="Nextcloud-NAS-Guide RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Nextcloud-NAS-Guide/news/atom.xml" title="Nextcloud-NAS-Guide Atom Feed"><link rel="stylesheet" href="/Nextcloud-NAS-Guide/assets/css/styles.29c760d0.css">
<link rel="preload" href="/Nextcloud-NAS-Guide/assets/js/runtime~main.01a4fed1.js" as="script">
<link rel="preload" href="/Nextcloud-NAS-Guide/assets/js/main.f835e646.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Nextcloud-NAS-Guide/"><div class="navbar__logo"><img src="/Nextcloud-NAS-Guide/img/favicon.webp" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/Nextcloud-NAS-Guide/img/favicon.webp" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Nextcloud-NAS</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Nextcloud-NAS-Guide/docs/">Guide</a><a class="navbar__item navbar__link" href="/Nextcloud-NAS-Guide/news">News</a><a href="https://github.com/szaimen/Nextcloud-NAS-Guide/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Nextcloud-NAS-Guide/docs/">Nextcloud-NAS-Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Nextcloud-NAS-Guide/docs/before-start">Before you start</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Nextcloud-NAS-Guide/docs/basic-setup">Basic setup</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Nextcloud-NAS-Guide/docs/security-automation">Security and Automation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Nextcloud-NAS-Guide/docs/external-drives">External drives</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Nextcloud-NAS-Guide/docs/backup">Backup</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Nextcloud-NAS-Guide/docs/smb-server">SMB-server and user accounts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Nextcloud-NAS-Guide/docs/customize-nextcloud">Customize Nextcloud</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Nextcloud-NAS-Guide/docs/activate-lets-encrypt">Activate Let&#x27;s Encrypt</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Nextcloud-NAS-Guide/docs/firewall">Optional</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/Nextcloud-NAS-Guide/docs/manual-backup">FAQ</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/Nextcloud-NAS-Guide/docs/manual-backup">Backup and Restore</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Nextcloud-NAS-Guide/docs/manual-backup">Create Backup manually</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Nextcloud-NAS-Guide/docs/restore-files">Restore files</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Nextcloud-NAS-Guide/docs/restore-system">Restore system</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Nextcloud-NAS-Guide/docs/restore-backup">Restore Backup/Upgrade Ubuntu</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Nextcloud-NAS-Guide/docs/access-backup">Backup drives - PC access</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Nextcloud-NAS-Guide/docs/improve-performance">Miscellaneous</a></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/Nextcloud-NAS-Guide/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">FAQ</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Backup and Restore</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Restore Backup/Upgrade Ubuntu</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>How to restore a Backup on a different server or upgrade Ubuntu?</h1></header><p>Theoretically it could happen that your system drive fails or that you need to update the Ubuntu version.
In those cases you need to reinstall Ubuntu and thus restore a backup on a different server (it looks like it is a different server for the scripts).</p><p>Here is what you need to do in those cases:</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="preparations-if-your-server-doesnt-work-because-of-a-failed-system-drive">Preparations (if your server doesn&#x27;t work because of a failed system drive)<a href="#preparations-if-your-server-doesnt-work-because-of-a-failed-system-drive" class="hash-link" aria-label="Direct link to Preparations (if your server doesn&#x27;t work because of a failed system drive)" title="Direct link to Preparations (if your server doesn&#x27;t work because of a failed system drive)">​</a></h2><ol><li>Buy a new with your server compatible internal SSD (recommended specifications describe <a href="/Nextcloud-NAS-Guide/docs/hardware-recommendations#general-hardware-recommendations">here</a>)</li><li>Put the new drive into your server</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="preparations-if-you-want-to-upgrade-ubuntu">Preparations (if you want to upgrade Ubuntu)<a href="#preparations-if-you-want-to-upgrade-ubuntu" class="hash-link" aria-label="Direct link to Preparations (if you want to upgrade Ubuntu)" title="Direct link to Preparations (if you want to upgrade Ubuntu)">​</a></h2><ol start="0"><li>If Pi-hole is set up as your local DNS-server, disable it in your router as you will not be able to use the internet at all when your server is powered off.</li><li>Update to the latest major Nextcloud release by following the instructions here: <a href="/Nextcloud-NAS-Guide/docs/major-update">click here</a><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>Please read carefully through all info there, especially the <code>Things to check before updating</code> section before updating. (E.g. it is not recommended to update to any new major Nextcloud release before the first point release: all info there is valid here, too.)</p></div></div><div class="theme-admonition theme-admonition-warning alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_S0QG"><p>At least Nextcloud 24 is required to proceed below, so make sure that you upgrade at least to this version!</p></div></div></li><li>Create a backup of your server (<a href="/Nextcloud-NAS-Guide/docs/manual-backup">instructions</a>)</li><li>Only if the backup (from step 2) was created successfully (otherwise skip this 3rd step!), get your <code>Off-Shore Backup HDD</code>, connect it to your server and create a new off-shore backup by running:<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sed</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;s|^DAYS_SINCE_LAST_BACKUP.*|DAYS_SINCE_LAST_BACKUP=1000|&#x27;</span><span class="token plain"> /var/scripts/off-shore-rsync-backup.sh </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">bash</span><span class="token plain"> /var/scripts/off-shore-rsync-backup.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>You should really only create a new off-shore backup if the backup from step 2 was created successfully!</p></div></div></li><li>Use your <strong>last chance</strong> and find out if you still have the passphrase of your backup stored at a safe place by comparing it with the output of:<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ENCRYPTION_KEY&quot;</span><span class="token plain"> /var/scripts/daily-borg-backup.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>If you don&#x27;t have it stored, just <strong>note it down</strong> another time. <strong>This is crucial!</strong><br>
(because this is the last chance to retrieve the password from your server)</p></div></div></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="execution">Execution<a href="#execution" class="hash-link" aria-label="Direct link to Execution" title="Direct link to Execution">​</a></h2><ol><li>If not already done, disable port-forwarding in your router for all ports in order to make sure that no changes are made in the meantime</li><li><strong>Shut down</strong> your server by pressing the power button</li><li><strong>Disconnect</strong> all external drives from your server</li><li><strong>Execute</strong> the complete Basic setup section (<a href="/Nextcloud-NAS-Guide/docs/basic-setup">this section</a>)<br><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Don&#x27;t go any further and stop at the beginning of the next section!<br>
(This is the last step that shall get executed: <a href="/Nextcloud-NAS-Guide/docs/usb-boot">click here</a>)</p></div></div></li><li>If you are done with the basic setup section, run the manual update once (<a href="/Nextcloud-NAS-Guide/docs/update-manually">instructions</a>)</li><li>Please <strong>don&#x27;t</strong> connect the backup HDD to your server, yet or <strong>disconnect</strong> the backup HDD from your server!</li><li>Now run the restore-backup script by executing:<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">wget</span><span class="token plain"> https://raw.githubusercontent.com/nextcloud/vm/main/not-supported/restore-backup.sh </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">bash</span><span class="token plain"> restore-backup.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li>Enter your password</li><li><strong>Confirm</strong> that you want to restore your server from backup</li><li>Press <code>OK</code> to start searching for new backup drives</li><li>Now <strong>connect</strong> one of your backup drives (most likely the daily backup HDD) to your server (you have 1 minute)</li><li>Choose the <strong>BTRFS/NTFS partition</strong> that shall get mounted</li><li><strong>Select</strong> one found valid backup repository</li><li>Enter the <strong>passphrase</strong> that was used to encrypt the backup</li><li><strong>Select</strong> the <code>backup archive</code> that shall get restored (most likely the newest one if your system was in a working state when the backup was created)</li><li><strong>Choose</strong> if you want to check if the backup extracting works (this is up to you)<br>
(If you choose yes and it takes too long, you can cancel it by pressing <code>[CTRL] + [C]</code>. Then start from step 5 again and simply skip it.)</li><li><strong>Confirm</strong> that you want to restore the backup</li><li>Now wait until you see the next popup! (This can take a while.)</li><li>It should now report that the restore was completed and you should connect all drives now. So please <strong>connect all external drives</strong> now that were connected to your old server!</li><li>Press <code>[ENTER]</code> so that they get mounted</li><li>Now you should see a popup were it is recommended to open your nextcloud web interface to confirm that the restore was successful. Do so by opening the suggested link. E.g. <code>https://192.168.178.144</code>. After you&#x27;ve confirmed that Nextcloud works, press <code>[ENTER]</code></li><li>Now it will report to you that you need to reinstall a lot of apps/addons in case they were installed on your old server. This is what you will do next. Press <code>[ENTER]</code> to exit the script.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="reinstall-apps-and-addons">Reinstall Apps and Addons<a href="#reinstall-apps-and-addons" class="hash-link" aria-label="Direct link to Reinstall Apps and Addons" title="Direct link to Reinstall Apps and Addons">​</a></h2><p>If the Nextcloud web interface works as expected, you will need to reinstall all apps/addons that were installed on your old server.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="necessary-are-those">Necessary are those<a href="#necessary-are-those" class="hash-link" aria-label="Direct link to Necessary are those" title="Direct link to Necessary are those">​</a></h3><ol><li>Reinstall Geoblocking (<a href="/Nextcloud-NAS-Guide/docs/geoblock">instructions</a>)</li><li>Reinstall Disk Monitoring (<a href="/Nextcloud-NAS-Guide/docs/smart">instructions</a>)</li><li>Reinstall Fail2Ban (<a href="/Nextcloud-NAS-Guide/docs/fail2ban">instructions</a>)</li><li>Reinstall ClamAV (<a href="/Nextcloud-NAS-Guide/docs/clamav">instructions</a>)</li><li>Reinstall SMTP Mail (<a href="/Nextcloud-NAS-Guide/docs/smtp-mail">instructions</a>)</li><li>Reinstall DDclient (<a href="/Nextcloud-NAS-Guide/docs/configure-ddclient">instructions</a>)</li><li>Reconfigure Port Forwarding (<a href="/Nextcloud-NAS-Guide/docs/port-forwarding">instructions</a>)</li><li>Reactivate TLS for your Nextcloud Domain (<a href="/Nextcloud-NAS-Guide/docs/activate-tls">instructions</a>)</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="now-your-nextcloud-should-work-again-completely">Now your Nextcloud should work again completely!<a href="#now-your-nextcloud-should-work-again-completely" class="hash-link" aria-label="Direct link to Now your Nextcloud should work again completely!" title="Direct link to Now your Nextcloud should work again completely!">​</a></h4><h3 class="anchor anchorWithStickyNavbar_LWe7" id="optional-are-those">Optional are those<a href="#optional-are-those" class="hash-link" aria-label="Direct link to Optional are those" title="Direct link to Optional are those">​</a></h3><p>(You only need to reinstall them <strong>if they were installed before</strong>)</p><ul><li>Reenable the Firewall on your server (<a href="/Nextcloud-NAS-Guide/docs/firewall">instructions</a>)</li><li>Reinstall OnlyOffice for Nextcloud (<a href="/Nextcloud-NAS-Guide/docs/onlyoffice">instructions</a>)</li><li>Reinstall High-Performance backend for Nextcloud Talk (<a href="/Nextcloud-NAS-Guide/docs/hpb">instructions</a>)</li><li>Reinstall Push Notifications for Nextcloud (<a href="/Nextcloud-NAS-Guide/docs/notify_push">instructions</a>)</li><li>Reinstall Whiteboard for Nextcloud (<a href="/Nextcloud-NAS-Guide/docs/whiteboard">instructions</a>)</li><li>Reinstall Pico CMS for Nextcloud (<a href="/Nextcloud-NAS-Guide/docs/pico">instructions</a>)</li><li>Reinstall Extract for Nextcloud (<a href="/Nextcloud-NAS-Guide/docs/extract">instructions</a>)</li><li>Reinstall PDF annotations (<a href="/Nextcloud-NAS-Guide/docs/pdfannotate">instructions</a>)</li><li>Reinstall Vaultwarden (formerly known as Bitwarden RS) (<a href="/Nextcloud-NAS-Guide/docs/vaultwarden">instructions</a>)<div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>Attention! Please use the <strong>same domain</strong> that you&#x27;ve used before for Bitwarden RS or Vaultwarden (if you&#x27;ve had Bitwarden RS or Vaultwarden installed on your old server!)</p></div></div></li><li>Reinstall Pi-hole (<a href="/Nextcloud-NAS-Guide/docs/pi-hole">instructions</a>)</li><li>Reinstall PiVPN (<a href="/Nextcloud-NAS-Guide/docs/pivpn">instructions</a>)</li><li>Redo the change of the update time (<a href="/Nextcloud-NAS-Guide/docs/change-update-time">instructions</a>)</li><li>Redo the change to only allow access to your server from inside your home network (<a href="/Nextcloud-NAS-Guide/docs/home-access-only">instructions</a>)</li><li>Reinstall Plex Media Server (<a href="/Nextcloud-NAS-Guide/docs/pms">instructions</a>)<div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>When reinstalling Plex, all drives that Plex shall have access to need to be mounted to the server! (Otherwise there could appear some problems.) You can make sure that this is the case by connecting all drives to your server and rebooting your sever before reinstalling Plex!</p></div></div></li><li>Reinstall Remotedesktop (<a href="/Nextcloud-NAS-Guide/docs/remotedesktop">instructions</a>)</li><li>Reinstall other apps that you might have had installed before (<a href="/Nextcloud-NAS-Guide/docs/more-apps">overview</a>) </li></ul><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>daily backup</div><div class="admonitionContent_S0QG"><p>Please note that the next scheduled daily backup will take a long time because the local borgbackup cache has to be rebuilt. So don&#x27;t be surprised if this is the case since it is completely normal!</p></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/szaimen/Nextcloud-NAS-Guide/edit/main/docs/restore-backup.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/Nextcloud-NAS-Guide/docs/restore-system"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Restore system</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Nextcloud-NAS-Guide/docs/access-backup"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Backup drives - PC access</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#preparations-if-your-server-doesnt-work-because-of-a-failed-system-drive" class="table-of-contents__link toc-highlight">Preparations (if your server doesn&#39;t work because of a failed system drive)</a></li><li><a href="#preparations-if-you-want-to-upgrade-ubuntu" class="table-of-contents__link toc-highlight">Preparations (if you want to upgrade Ubuntu)</a></li><li><a href="#execution" class="table-of-contents__link toc-highlight">Execution</a></li><li><a href="#reinstall-apps-and-addons" class="table-of-contents__link toc-highlight">Reinstall Apps and Addons</a><ul><li><a href="#necessary-are-those" class="table-of-contents__link toc-highlight">Necessary are those</a></li><li><a href="#optional-are-those" class="table-of-contents__link toc-highlight">Optional are those</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Nextcloud-NAS-Guide/docs/impressum">Impressum</a></li><li class="footer__item"><a class="footer__link-item" href="/Nextcloud-NAS-Guide/docs/privacy">Privacy Policy</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 <a href="https://github.com/szaimen">szaimen</a> - Built with Docusaurus.</div></div></div></footer></div>
<script src="/Nextcloud-NAS-Guide/assets/js/runtime~main.01a4fed1.js"></script>
<script src="/Nextcloud-NAS-Guide/assets/js/main.f835e646.js"></script>
</body>
</html>